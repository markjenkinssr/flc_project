{% extends "base.html" %}
{% block title %}FLC Registration{% endblock %}

{% block content %}
<h1 class="mb-3">FLC Registration for {{ advisor.first_name }} {{ advisor.last_name }}</h1>

<div class="alert alert-info d-flex justify-content-between align-items-center">
  <div>
    Fee per participant: <strong>${{ fee }}</strong><br>
    Current total: <strong>{{ participant_count }} Ã— ${{ fee }} = ${{ total_cost }}</strong>
  </div>
  <div class="ms-3">
    <!-- Finish button aligned to the right -->
    <a href="{{ finish_session_url }}" class="btn btn-success">Finish &amp; Summary</a>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header">Add Participant</div>
  <div class="card-body">
    <form method="post" novalidate>
      {% csrf_token %}
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">First Name</label>
          {{ form.first_name }}
        </div>
        <div class="col-md-6">
          <label class="form-label">Last Name</label>
          {{ form.last_name }}
        </div>

        <div class="col-md-6">
          <label class="form-label">Student Organization</label>
          {{ form.student_organization }}
        </div>
        <div class="col-md-6">
          <label class="form-label">College/Company</label>
          {{ form.college_company }}
        </div>

        <div class="col-md-6">
          <label class="form-label">Tour</label>
          {{ form.tour }}
        </div>
        <div class="col-md-6">
          <label class="form-label">T-Shirt Size</label>
          {{ form.tee_shirt_size }}
        </div>

        <div class="col-md-6">
          <label class="form-label">Food Allergy</label>
          {{ form.food_allergy }}
        </div>
        <div class="col-md-6">
          <label class="form-label">ADA Needs</label>
          {{ form.ada_needs }}
        </div>
      </div>

      <div class="mt-3">
        <button type="submit" class="btn btn-primary">Add Participant</button>
      </div>
    </form>
  </div>
</div>

<h2 class="h5">Current Participants ({{ advisor.registrations.count }})</h2>
<div class="table-responsive">
  <table class="table table-sm align-middle">
    <thead>
      <tr>
        <th>Name</th>
        <th>Student Org</th>
        <th>College/Company</th>
        <th>Tour</th>
        <th>Tee</th>
        <th>Fee</th>
        <th class="text-end">Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for r in advisor.registrations.all|dictsort:"last_name" %}
      <tr>
        <td>{{ r.first_name }} {{ r.last_name }}</td>
        <td>{{ r.student_organization }}</td>
        <td>{{ r.college_company }}</td>
        <td>{{ r.tour }}</td>
        <td>{{ r.tee_shirt_size }}</td>
        <td>${{ fee }}</td>
        <td class="text-end">
          <a href="{% url 'registrations:registration_edit' advisor.id r.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
          <form method="post" action="{% url 'registrations:registration_delete' advisor.id r.id %}" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this participant?');">
              Delete
            </button>
          </form>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="7" class="text-muted">No participants yet.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
